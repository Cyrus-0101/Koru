<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Koru Game Engine: Koru</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Koru Game Engine<span id="projectnumber">&#160;0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Koru </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <a href="https://github.com/Cyrus-0101/Koru/actions"><img src="https://github.com/Cyrus-0101/Koru/workflows/CI/badge.svg" alt="Build Status" style="pointer-events: none;" class="inline"/></a></p>
<blockquote class="doxtable">
<p>&zwj;<em>A lightweight, multi-platform game engine built in C using the Vulkan graphics API.</em> </p>
</blockquote>
<p>Koru is designed to be fast, portable, and easy to extend ‚Äî providing a low-level foundation for game development across platforms including Windows, Linux, and soon consoles and mobile devices.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md4"></a>
üß† What Is Koru?</h1>
<p>Koru is a <b>C99-based game engine</b> focused on performance, portability, and modularity. It's ideal for developers who want fine-grained control over rendering, input, memory, and platform-specific functionality without the overhead of high-level abstractions.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
üöÄ Features:</h2>
<ul>
<li>Written entirely in <b>C99</b> ‚Äì minimal dependencies</li>
<li><b>Vulkan-based renderer</b> for high-performance graphics</li>
<li>Cross-platform: <b>Windows, Linux, Mac</b> (with future plans for consoles and mobile)</li>
<li>Modular architecture for <b>easy extension</b></li>
<li>Custom <b>memory allocators</b>, <b>logging</b>, <b>assertions</b>, and <b>data structures</b> etc</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md7"></a>
üñº Architecture</h1>
<p>The high-level architecture of Koru is divided into four main layers:</p>
<h2><a class="anchor" id="autotoc_md8"></a>
1. &lt;strong&gt;Platform Layer&lt;/strong&gt;</h2>
<p>Handles OS-specific functionality:</p>
<ul>
<li><b>Windowing</b>: Creates and manages windows on Windows/Linux/Mac.</li>
<li><b>Input</b>: Manages keyboard, mouse, and gamepad input.</li>
<li><b>File I/O</b>: Provides cross-platform file system access.</li>
<li><b>Console Output</b>: Handles logging and debugging output.</li>
<li><b>Memory Management</b>: Allocates and frees memory efficiently.</li>
<li><b>Renderer API Extensions</b>: Integrates with Vulkan for rendering.</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
2. &lt;strong&gt;Core&lt;/strong&gt;</h2>
<p>Provides fundamental utilities and services:</p>
<ul>
<li><b>Logger</b>: Logs messages for debugging and monitoring.</li>
<li><b>Assertions</b>: Ensures correctness during development.</li>
<li><b>Data Structures</b>: Efficient containers like dynamic arrays, linked lists, etc.</li>
<li><b>Memory Allocators</b>: Custom allocators for optimized memory usage.</li>
<li><b>Math Library</b>: Vector, matrix, and quaternion operations.</li>
<li><b>Parsers</b>: Parses formats like XML, CSV, JSON, etc.</li>
<li><b>Engine Configuration</b>: Loads and manages engine settings.</li>
<li><b>Profiling</b>: Measures performance bottlenecks.</li>
<li><b>Async File I/O</b>: Asynchronous file operations for non-blocking I/O.</li>
<li><b>Localization</b>: Supports internationalization.</li>
<li><b>String Library</b>: String manipulation utilities.</li>
<li><b>Random Number Generator (RNG)</b>: Generates random numbers for simulations and AI.</li>
</ul>
<h2><a class="anchor" id="autotoc_md10"></a>
3. &lt;strong&gt;Resource Management&lt;/strong&gt;</h2>
<p>Manages various assets:</p>
<ul>
<li><b>Images</b>: Texture loading and caching.</li>
<li><b>Materials</b>: Shader and lighting configurations.</li>
<li><b>Meshes</b>: 3D model loading and processing.</li>
<li><b>Animations</b>: Skeletal animations and timeline systems.</li>
<li><b>World Maps</b>: Terrain and level data management.</li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
4. &lt;strong&gt;Application Layer&lt;/strong&gt;</h2>
<p>Contains higher-level systems:</p>
<ul>
<li><b>Renderer Front End</b>: GUI, camera management, post-processing effects.</li>
<li><b>Renderer Back End</b>: Scene graph, materials, shaders, meshes, textures.</li>
<li><b>Audio</b>: 2D/3D audio playback, effects, and spatial audio.</li>
<li><b>Others</b>: Animation/timelines, event system, ECS, state machines, collision/physics.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md13"></a>
üìã Feature List</h1>
<p>Here‚Äôs a summary of the features to be implemented in v0.1:</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Core Features</h2>
<ul>
<li><b>Lightweight build system</b>: Simple scripts for compiling on Windows and Linux.</li>
<li><b>Low-level utilities</b>:<ul>
<li>Dynamic arrays</li>
<li>String handling</li>
<li>Memory allocators</li>
<li>Profiling tools</li>
<li>Assertions</li>
<li>Logging</li>
</ul>
</li>
<li><b>Platform layer</b>:<ul>
<li>Window creation and management</li>
<li>Input handling (keyboard, mouse, gamepad)</li>
<li>File I/O</li>
<li>Console output</li>
</ul>
</li>
<li><b>Renderer/API Abstraction Layer</b>: Uses Vulkan for cross-platform rendering.</li>
<li><b>Memory Management</b>: Custom allocators for efficient memory use.</li>
<li><b>Scenegraph/ECS</b>: Hierarchical scene management and entity-component-system architecture.</li>
<li><b>Profiling/Debugging utilities</b>: Tools for measuring performance and identifying bottlenecks.</li>
<li>**"Scripting" support via hot reloading**: Experimental support for scripting through hot-reloading mechanisms.</li>
</ul>
<h2><a class="anchor" id="autotoc_md15"></a>
Planned Features</h2>
<ul>
<li>Mobile and console support</li>
<li>Full audio subsystem</li>
<li>Physics and collision detection</li>
<li>Advanced animation system</li>
<li>Improved asset pipeline</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md17"></a>
üé® Visuals</h1>
<p>Check out the diagrams included in the <code>assets/</code> folder to understand how everything fits together:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Diagram   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><img src="assets/Koru%20Engine%20Architecture.png" alt="Architecture" class="inline"/>   </td><td class="markdownTableBodyNone">High-level overview of system modules and interactions    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><img src="assets/Koru%20Project%20Structure.png" alt="Project Structure" class="inline"/>   </td><td class="markdownTableBodyNone">File structure and module organization    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><img src="assets/Koru%20v0.1%20Feature%20List.png" alt="Feature List v0.1" class="inline"/>   </td><td class="markdownTableBodyNone">Summary of current capabilities and roadmap   </td></tr>
</table>
<hr  />
<h1><a class="anchor" id="autotoc_md19"></a>
üìÅ Project Structure</h1>
<div class="fragment"><div class="line">.</div>
<div class="line">‚îú‚îÄ‚îÄ assets</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ Koru Engine Architecture.png        # High-level system architecture diagram</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ Koru Project Structure.png          # Visual representation of file organization</div>
<div class="line">‚îÇ   ‚îî‚îÄ‚îÄ Koru v0.1 Feature List.png          # Summary of current features and roadmap</div>
<div class="line">‚îú‚îÄ‚îÄ bin</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ libengine.so                        # Compiled engine shared library (Linux)</div>
<div class="line">‚îÇ   ‚îî‚îÄ‚îÄ testbed                             # Testbed application binary (Linux)</div>
<div class="line">‚îú‚îÄ‚îÄ build-all.bat                           # Windows: Runs all builds sequentially</div>
<div class="line">‚îú‚îÄ‚îÄ build-all.sh                            # Linux: Runs all builds sequentially</div>
<div class="line">‚îú‚îÄ‚îÄ Doxyfile                                # Configuration for generating API documentation with Doxygen</div>
<div class="line">‚îú‚îÄ‚îÄ engine</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ build.bat                           # Windows: Builds engine DLL</div>
<div class="line">‚îÇ   ‚îú‚îÄ‚îÄ build.sh                            # Linux: Builds engine shared object (.so)</div>
<div class="line">‚îÇ   ‚îî‚îÄ‚îÄ src</div>
<div class="line">‚îÇ       ‚îú‚îÄ‚îÄ containers</div>
<div class="line">‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ darray.c                    # Implementation of dynamic array container</div>
<div class="line">‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ darray.h                    # Public interface for dynamic arrays</div>
<div class="line">‚îÇ       ‚îú‚îÄ‚îÄ core</div>
<div class="line">‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ application.c               # Application lifecycle implementation (init/run/shutdown)</div>
<div class="line">‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ application.h               # Public interface for the application system</div>
<div class="line">‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ asserts.h                   # Custom assertion macros and debugging utilities</div>
<div class="line">‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ event.c                     # Event system implementation (register/unregister/fire)</div>
<div class="line">‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ event.h                     # Public interface for event handling system</div>
<div class="line">‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ kmemory.c                   # Memory allocation system with tagging support</div>
<div class="line">‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ kmemory.h                   # Interface for tagged memory management</div>
<div class="line">‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ logger.c                    # Logging system with color-coded output</div>
<div class="line">‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ logger.h                   # Public interface for logging module</div>
<div class="line">‚îÇ       ‚îú‚îÄ‚îÄ defines.h                       # Common type definitions, macros, and platform detection</div>
<div class="line">‚îÇ       ‚îú‚îÄ‚îÄ entry.h                         # Entry point interface; declares create_game()</div>
<div class="line">‚îÇ       ‚îú‚îÄ‚îÄ game_types.h                    # Game-related types used across engine and game logic</div>
<div class="line">‚îÇ       ‚îî‚îÄ‚îÄ platform</div>
<div class="line">‚îÇ           ‚îú‚îÄ‚îÄ platform.h                 # Platform abstraction layer interface</div>
<div class="line">‚îÇ           ‚îú‚îÄ‚îÄ platform_linux.c           # Linux-specific implementation of platform functions</div>
<div class="line">‚îÇ           ‚îî‚îÄ‚îÄ platform_win32.c           # Windows-specific implementation of platform functions</div>
<div class="line">‚îú‚îÄ‚îÄ LICENSE                                 # MIT License file</div>
<div class="line">‚îú‚îÄ‚îÄ README.md                               # This file - main project overview and guide</div>
<div class="line">‚îú‚îÄ‚îÄ test</div>
<div class="line">‚îÇ   ‚îî‚îÄ‚îÄ platform                           # Unit tests for platform module</div>
<div class="line">‚îú‚îÄ‚îÄ testbed</div>
<div class="line">    ‚îú‚îÄ‚îÄ build.bat                           # Windows: Builds testbed application</div>
<div class="line">    ‚îú‚îÄ‚îÄ build.sh                            # Linux: Builds testbed application</div>
<div class="line">    ‚îî‚îÄ‚îÄ src</div>
<div class="line">        ‚îú‚îÄ‚îÄ entry.c                         # Entry point for testbed app; implements create_game()</div>
<div class="line">        ‚îú‚îÄ‚îÄ game.c                          # Testbed game logic (initialize/update/render stubs)</div>
<div class="line">        ‚îî‚îÄ‚îÄ game.h                          # Interface for testbed game implementation</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md21"></a>
‚öôÔ∏è Build Scripts/Instructions</h1>
<p>Check tasks.json for sequence:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File   </th><th class="markdownTableHeadNone">Purpose   </th><th class="markdownTableHeadNone">Notes    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>engine/build.sh</code>   </td><td class="markdownTableBodyNone">Builds engine <code>.so</code> (shared lib) on Linux   </td><td class="markdownTableBodyNone">Uses Vulkan/XCB/X11    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>engine/build.bat</code>   </td><td class="markdownTableBodyNone">Builds engine <code>.dll</code> on Windows   </td><td class="markdownTableBodyNone">Links with Vulkan SDK    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>testbed/build.sh</code>   </td><td class="markdownTableBodyNone">Builds testbed app using engine <code>.so</code> on Linux   </td><td class="markdownTableBodyNone">Sets RPATH for easy loading    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>testbed/build.bat</code>   </td><td class="markdownTableBodyNone">Builds testbed <code>.exe</code> using engine <code>.dll</code> on Windows   </td><td class="markdownTableBodyNone">Links <code>.lib</code> import library    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>build-all.sh</code>   </td><td class="markdownTableBodyNone">Runs all Linux builds sequentially   </td><td class="markdownTableBodyNone">Checks for errors    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>build-all.bat</code>   </td><td class="markdownTableBodyNone">Runs all Windows builds sequentially   </td><td class="markdownTableBodyNone">Same as above but for Windows   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md22"></a>
Linux</h2>
<p>Make sure Clang and the Vulkan SDK are installed. Alternatively install VSCode and run the debugger (Commonly F5, and run the engine)</p>
<div class="fragment"><div class="line"># Give execution permissions</div>
<div class="line">chmod +x build-all.sh</div>
<div class="line"> </div>
<div class="line"># Run the build</div>
<div class="line">./build-all.sh</div>
</div><!-- fragment --><p>The output will be placed in <code>bin/</code>:</p>
<ul>
<li><code>libengine.so</code> ‚Äì The engine shared library</li>
<li><code>testbed</code> ‚Äì The testbed executable</li>
</ul>
<h2><a class="anchor" id="autotoc_md23"></a>
Windows</h2>
<p>Ensure:</p>
<ul>
<li>Clang is available</li>
<li>Vulkan SDK is installed and <code>VULKAN_SDK</code> environment variable is set</li>
<li>VS Code makes it easy to run the tasks in the .vscode/tasks.json file.</li>
</ul>
<p>Then run:</p>
<div class="fragment"><div class="line">build-all.bat</div>
</div><!-- fragment --><p>Output files:</p>
<ul>
<li><code>bin\engine.dll</code></li>
<li><code>bin\testbed.exe</code></li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md25"></a>
üîÆ Roadmap</h1>
<p>Plans to expand Koru include:</p>
<ul>
<li>‚úÖ <b>Rendering Layer</b><ul>
<li>[ ] Vulkan renderer initialization</li>
<li>[ ] Swapchain setup</li>
<li>[ ] Command buffers, pipelines, shaders</li>
</ul>
</li>
<li>‚úÖ <b>Input System</b><ul>
<li>[ ] Keyboard/mouse/gamepad support</li>
<li>[ ] Input mapping and event system</li>
</ul>
</li>
<li>‚úÖ <b>Asset Management</b><ul>
<li>[ ] Texture loader</li>
<li>[ ] Mesh format and loader</li>
<li>[ ] Material system</li>
</ul>
</li>
<li>‚úÖ <b>Audio System</b><ul>
<li>[ ] Basic sound playback</li>
<li>[ ] Cross-platform audio backend</li>
</ul>
</li>
<li>‚úÖ <b>Multi-Platform Support</b><ul>
<li>[ ] Console (PlayStation, Xbox, Switch)</li>
<li>[ ] Mobile (Android/iOS)</li>
</ul>
</li>
<li>‚úÖ <b>Editor Tools</b><ul>
<li>[ ] Simple scene editor</li>
<li>[ ] Asset pipeline tools</li>
</ul>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md27"></a>
üí° Want to Help?</h1>
<p>Contributions are welcome! Whether you're interested in:</p>
<ul>
<li>Writing documentation</li>
<li>Implementing new features</li>
<li>Fixing bugs</li>
<li>Improving tooling or build scripts</li>
</ul>
<p>Feel free to open an issue or PR!</p>
<hr  />
<h1><a class="anchor" id="autotoc_md29"></a>
üìÑ License</h1>
<p>This project is licensed under the MIT License ‚Äì see the [LICENSE](LICENSE) file for details.</p>
<div class="fragment"><div class="line">## üöÄ Next Steps</div>
<div class="line"> </div>
<div class="line">TO-DO: Add:</div>
<div class="line"> </div>
<div class="line">- ‚úÖ A **Getting Started Guide** (`docs/getting-started.md`)</div>
<div class="line">- ‚úÖ A **Contribution Guide** (`CONTRIBUTING.md`)</div>
<div class="line">- ‚úÖ A **Code of Conduct** (`CODE_OF_CONDUCT.md`)</div>
<div class="line">- ‚úÖ GitHub Actions for CI builds (optional)</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md31"></a>
üéÆ Koru Engine ‚Äì Rendering System (Vulkan)</h1>
<blockquote class="doxtable">
<p>&zwj;<em>A deep dive into how Koru sets up its Vulkan-based rendering system ‚Äî from instance creation to frame submission.</em> </p>
</blockquote>
<p>Koru is a <b>low-level game engine</b> written in C99 that uses the <b>Vulkan graphics API</b> for rendering. This document explains the <b>entire rendering pipeline setup</b> used in Koru, including:</p><ul>
<li>Instance creation</li>
<li>Physical device selection</li>
<li>Logical device creation</li>
<li>Surface &amp; swapchain setup</li>
<li>Render passes</li>
<li>Framebuffers</li>
<li>Command buffers</li>
</ul>
<p>This guide assumes some basic knowledge of C and Vulkan concepts. If you're new to Vulkan, this will help understand what‚Äôs happening behind the scenes as you run the testbed.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md33"></a>
üß† Why Use Vulkan?</h2>
<p>Vulkan gives developers <b>explicit control over GPU operations</b>. It allows fine-grained access to queues, memory, and rendering pipelines ‚Äî which is great for performance, but comes at the cost of complexity.</p>
<p>Koru abstracts much of that complexity using a <b>modular architecture</b>, allowing you to build a rendering system step-by-step without needing to manage everything manually every time.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md35"></a>
üì¶ High-Level Architecture (Render Layer)</h2>
<div class="fragment"><div class="line">+------------------+</div>
<div class="line">|   Application    |</div>
<div class="line">|     Logic        |</div>
<div class="line">|  (game.c)        |</div>
<div class="line">+------------------+</div>
<div class="line">         |</div>
<div class="line">         v</div>
<div class="line">+------------------+</div>
<div class="line">|   Renderer       |</div>
<div class="line">|   Frontend       |</div>
<div class="line">| (renderer_frontend.h/c) |</div>
<div class="line">+------------------+</div>
<div class="line">         |</div>
<div class="line">         v</div>
<div class="line">+------------------+</div>
<div class="line">|   Platform       |</div>
<div class="line">|   Abstraction    |</div>
<div class="line">| (platform_linux.c)|</div>
<div class="line">+------------------+</div>
<div class="line">         |</div>
<div class="line">         v</div>
<div class="line">+------------------+</div>
<div class="line">|   Vulkan         |</div>
<div class="line">|   Device         |</div>
<div class="line">| (vulkan_device.c/h) |</div>
<div class="line">+------------------+</div>
<div class="line">         |</div>
<div class="line">         v</div>
<div class="line">+------------------+</div>
<div class="line">|   Swapchain      |</div>
<div class="line">|   Management     |</div>
<div class="line">| (vulkan_swapchain.c/h) |</div>
<div class="line">+------------------+</div>
<div class="line">         |</div>
<div class="line">         v</div>
<div class="line">+------------------+</div>
<div class="line">|   Render Pass /  |</div>
<div class="line">|   Framebuffer    |</div>
<div class="line">| (vulkan_renderpass.c/h) |</div>
<div class="line">+------------------+</div>
<div class="line">         |</div>
<div class="line">         v</div>
<div class="line">+------------------+</div>
<div class="line">|   Image          |</div>
<div class="line">|   Management     |</div>
<div class="line">| (vulkan_image.c/h) |</div>
<div class="line">+------------------+</div>
<div class="line">         |</div>
<div class="line">         v</div>
<div class="line">+------------------+</div>
<div class="line">|   Command Buffer |</div>
<div class="line">|   Submission     |</div>
<div class="line">| (renderer_frontend.c) |</div>
<div class="line">+------------------+</div>
</div><!-- fragment --><p>This shows how each module fits into the overall rendering flow.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md37"></a>
üõ†Ô∏è The Full Rendering Setup Process</h2>
<p>Let‚Äôs walk through <b>each stage of the rendering setup process</b>, with real code examples from the engine.</p>
<hr  />
<h3><a class="anchor" id="autotoc_md39"></a>
1. üß± Create Vulkan Instance</h3>
<p>The first thing to do is creating a <b>VkInstance</b> ‚Äî this connects the app to the Vulkan library.</p>
<div class="fragment"><div class="line"><span class="comment">// From vulkan_renderer_backend_initialize()</span></div>
<div class="line">VkApplicationInfo app_info = {VK_STRUCTURE_TYPE_APPLICATION_INFO};</div>
<div class="line">app_info.apiVersion = VK_MAKE_API_VERSION(0, 1, 4, 0);</div>
<div class="line">app_info.pApplicationName = application_name;</div>
<div class="line">app_info.applicationVersion = VK_MAKE_API_VERSION(0, 0, 0, 1);</div>
<div class="line">app_info.pEngineName = <span class="stringliteral">&quot;Koru Engine&quot;</span>;</div>
<div class="line">app_info.engineVersion = VK_MAKE_API_VERSION(0, 0, 0, 1);</div>
<div class="line"> </div>
<div class="line">VkInstanceCreateInfo create_info = {VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO};</div>
<div class="line">create_info.pApplicationInfo = &amp;app_info;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>** required_extensions = <a class="code hl_define" href="darray_8h.html#ab9d093e09b642e0d480a7ae82bad3af5">darray_create</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>*);</div>
<div class="line"><a class="code hl_define" href="darray_8h.html#a7ad89931e6589fa09b83ea99de2b32e6">darray_push</a>(required_extensions, &amp;VK_KHR_SURFACE_EXTENSION_NAME);</div>
<div class="line"><a class="code hl_function" href="vulkan__platform_8h.html#ac6f33d791e5445db00300cfd71d88702">platform_get_required_extension_names</a>(&amp;required_extensions);</div>
<div class="line"> </div>
<div class="line">create_info.enabledExtensionCount = <a class="code hl_define" href="darray_8h.html#aa556263c163ffb9f29b40b29b7b25165">darray_length</a>(required_extensions);</div>
<div class="line">create_info.ppEnabledExtensionNames = required_extensions;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Enable validation layers if _DEBUG is defined</span></div>
<div class="line"><span class="preprocessor">#if defined(_DEBUG)</span></div>
<div class="line">    create_info.enabledLayerCount = required_validation_layer_count;</div>
<div class="line">    create_info.ppEnabledLayerNames = required_validation_layer_names;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">VK_CHECK(vkCreateInstance(&amp;create_info, <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>.allocator, &amp;<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>.instance));</div>
<div class="ttc" id="adarray_8h_html_a7ad89931e6589fa09b83ea99de2b32e6"><div class="ttname"><a href="darray_8h.html#a7ad89931e6589fa09b83ea99de2b32e6">darray_push</a></div><div class="ttdeci">#define darray_push(array, value)</div><div class="ttdoc">Adds an element to the end of the array.</div><div class="ttdef"><b>Definition</b> <a href="darray_8h_source.html#l00182">darray.h:182</a></div></div>
<div class="ttc" id="adarray_8h_html_aa556263c163ffb9f29b40b29b7b25165"><div class="ttname"><a href="darray_8h.html#aa556263c163ffb9f29b40b29b7b25165">darray_length</a></div><div class="ttdeci">#define darray_length(array)</div><div class="ttdoc">Gets the current length (number of elements) in the array.</div><div class="ttdef"><b>Definition</b> <a href="darray_8h_source.html#l00258">darray.h:258</a></div></div>
<div class="ttc" id="adarray_8h_html_ab9d093e09b642e0d480a7ae82bad3af5"><div class="ttname"><a href="darray_8h.html#ab9d093e09b642e0d480a7ae82bad3af5">darray_create</a></div><div class="ttdeci">#define darray_create(type)</div><div class="ttdoc">Creates a dynamic array with default capacity for a specific type.</div><div class="ttdef"><b>Definition</b> <a href="darray_8h_source.html#l00148">darray.h:148</a></div></div>
<div class="ttc" id="avulkan__backend_8c_html_a171b208055a0eb2eeace24e130f74bc9"><div class="ttname"><a href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a></div><div class="ttdeci">static vulkan_context context</div><div class="ttdef"><b>Definition</b> <a href="vulkan__backend_8c_source.html#l00028">vulkan_backend.c:28</a></div></div>
<div class="ttc" id="avulkan__platform_8h_html_ac6f33d791e5445db00300cfd71d88702"><div class="ttname"><a href="vulkan__platform_8h.html#ac6f33d791e5445db00300cfd71d88702">platform_get_required_extension_names</a></div><div class="ttdeci">void platform_get_required_extension_names(const char ***names_darray)</div><div class="ttdoc">Appends the names of required Vulkan instance extensions for the current platform.</div></div>
</div><!-- fragment --><p>‚úÖ This creates the <b>main connection to Vulkan</b>, enabling extensions and validation layers.</p>
<hr  />
<h3><a class="anchor" id="autotoc_md41"></a>
2. üñ• Create Window Surface</h3>
<p>Next, to create a <b>surface</b> ‚Äî this is what connects the window to the GPU.</p>
<p>In Linux:</p>
<div class="fragment"><div class="line"><span class="comment">// platform_linux.c</span></div>
<div class="line">xcb_intern_atom_reply_t* wm_delete_reply = xcb_intern_atom_reply(...);</div>
<div class="line"><a class="code hl_variable" href="event_8c.html#acfc52e8e20887a09d8db0da0067c76e5">state</a>-&gt;wm_delete_win = wm_delete_reply-&gt;atom;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create surface</span></div>
<div class="line">VkXcbSurfaceCreateInfoKHR surface_create_info = {VK_STRUCTURE_TYPE_XCB_SURFACE_CREATE_INFO_KHR};</div>
<div class="line">surface_create_info.connection = <a class="code hl_variable" href="event_8c.html#acfc52e8e20887a09d8db0da0067c76e5">state</a>-&gt;connection;</div>
<div class="line">surface_create_info.window = <a class="code hl_variable" href="event_8c.html#acfc52e8e20887a09d8db0da0067c76e5">state</a>-&gt;window;</div>
<div class="line"> </div>
<div class="line">vkCreateXcbSurfaceKHR(<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;instance, &amp;surface_create_info, <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;allocator, &amp;<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;surface);</div>
<div class="ttc" id="aevent_8c_html_acfc52e8e20887a09d8db0da0067c76e5"><div class="ttname"><a href="event_8c.html#acfc52e8e20887a09d8db0da0067c76e5">state</a></div><div class="ttdeci">static event_system_state state</div><div class="ttdoc">Static global instance of the event system state.</div><div class="ttdef"><b>Definition</b> <a href="event_8c_source.html#l00074">event.c:74</a></div></div>
</div><!-- fragment --><p>In Windows: The engine uses <code>vkCreateWin32SurfaceKHR()</code> instead.</p>
<p>‚úÖ A surface is essential because it defines where rendered frames go usually the screen or a window.</p>
<hr  />
<h3><a class="anchor" id="autotoc_md43"></a>
3. üîç Query Physical Devices</h3>
<p>Once an instance and a surface are ready, query available GPUs:</p>
<div class="fragment"><div class="line"><span class="comment">// vulkan_device.c</span></div>
<div class="line"><a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> physical_device_count = 0;</div>
<div class="line">VK_CHECK(vkEnumeratePhysicalDevices(<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.physical_device, &amp;physical_device_count, 0));</div>
<div class="line"> </div>
<div class="line">VkPhysicalDevice physical_devices[physical_device_count];</div>
<div class="line">VK_CHECK(vkEnumeratePhysicalDevices(<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;instance, &amp;physical_device_count, physical_devices));</div>
<div class="ttc" id="adefines_8h_html_a10e94b422ef0c20dcdec20d31a1f5049"><div class="ttname"><a href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a></div><div class="ttdeci">unsigned int u32</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00023">defines.h:23</a></div></div>
</div><!-- fragment --><p>Then select one that meets requirements:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> i = 0; i &lt; physical_device_count; ++i) {</div>
<div class="line">    VkPhysicalDeviceProperties properties;</div>
<div class="line">    vkGetPhysicalDeviceProperties(physical_devices[i], &amp;properties);</div>
<div class="line"> </div>
<div class="line">    VkPhysicalDeviceFeatures features;</div>
<div class="line">    vkGetPhysicalDeviceFeatures(physical_devices[i], &amp;features);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check queue family support</span></div>
<div class="line">    <a class="code hl_struct" href="structvulkan__physical__device__queue__family__info.html">vulkan_physical_device_queue_family_info</a> queue_info = {};</div>
<div class="line">    vulkan_swapchain_support_info swapchain_support = {};</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a7415f24c35cb3e16a79f143c5527fdfa">b8</a> result = <a class="code hl_function" href="vulkan__device_8c.html#aa53d88ed2ed351537ad6b3f6ff109f7c">physical_device_meets_requirements</a>(</div>
<div class="line">        physical_devices[i],</div>
<div class="line">        <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;surface,</div>
<div class="line">        &amp;properties,</div>
<div class="line">        &amp;features,</div>
<div class="line">        &amp;requirements,</div>
<div class="line">        &amp;queue_info,</div>
<div class="line">        &amp;swapchain_support);</div>
<div class="line">}</div>
<div class="ttc" id="adefines_8h_html_a7415f24c35cb3e16a79f143c5527fdfa"><div class="ttname"><a href="defines_8h.html#a7415f24c35cb3e16a79f143c5527fdfa">b8</a></div><div class="ttdeci">char b8</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00055">defines.h:55</a></div></div>
<div class="ttc" id="astructvulkan__physical__device__queue__family__info_html"><div class="ttname"><a href="structvulkan__physical__device__queue__family__info.html">vulkan_physical_device_queue_family_info</a></div><div class="ttdoc">Stores indices of queue families for a physical device.</div><div class="ttdef"><b>Definition</b> <a href="vulkan__device_8c_source.html#l00072">vulkan_device.c:72</a></div></div>
<div class="ttc" id="avulkan__device_8c_html_aa53d88ed2ed351537ad6b3f6ff109f7c"><div class="ttname"><a href="vulkan__device_8c.html#aa53d88ed2ed351537ad6b3f6ff109f7c">physical_device_meets_requirements</a></div><div class="ttdeci">b8 physical_device_meets_requirements(VkPhysicalDevice device, VkSurfaceKHR surface, const VkPhysicalDeviceProperties *properties, const VkPhysicalDeviceFeatures *features, const vulkan_physical_device_requirements *requirements, vulkan_physical_device_queue_family_info *out_queue_family_info, vulkan_swapchain_support_info *out_swapchain_support)</div><div class="ttdoc">Checks whether the given physical device meets all specified requirements.</div><div class="ttdef"><b>Definition</b> <a href="vulkan__device_8c_source.html#l00506">vulkan_device.c:506</a></div></div>
</div><!-- fragment --><p>üîç Requirements include:</p><ul>
<li>Graphics/Compute/Present/Transfer queues</li>
<li>Extensions like <code>VK_KHR_SWAPCHAIN_EXTENSION_NAME</code></li>
<li>Features like <code>samplerAnisotropy</code></li>
<li>Prefer discrete GPU (optional)</li>
</ul>
<hr  />
<h3><a class="anchor" id="autotoc_md45"></a>
4. üîÑ Create Logical Device</h3>
<p>After selecting a suitable physical device, create a <b>logical device</b> to interface with the GPU.</p>
<div class="fragment"><div class="line"><span class="comment">// vulkan_device.c</span></div>
<div class="line"><a class="code hl_typedef" href="defines_8h.html#a7415f24c35cb3e16a79f143c5527fdfa">b8</a> present_shares_graphics_queue = (<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.graphics_queue_index == <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.present_queue_index);</div>
<div class="line"><a class="code hl_typedef" href="defines_8h.html#a7415f24c35cb3e16a79f143c5527fdfa">b8</a> transfer_shares_graphics_queue = (<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.graphics_queue_index == <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.transfer_queue_index);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> index_count = 1;</div>
<div class="line"><span class="keywordflow">if</span> (!present_shares_graphics_queue) index_count++;</div>
<div class="line"><span class="keywordflow">if</span> (!transfer_shares_graphics_queue) index_count++;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> indices[index_count];</div>
<div class="line">indices[0] = <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.graphics_queue_index;</div>
<div class="line">...</div>
</div><!-- fragment --><p>Define the queues as needed:</p>
<div class="fragment"><div class="line">VkDeviceQueueCreateInfo queue_create_infos[index_count];</div>
<div class="line"><span class="keywordflow">for</span> (<a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> i = 0; i &lt; index_count; ++i) {</div>
<div class="line">    queue_create_infos[i].sType = VK_STRUCTURE_TYPE_DEVICE_QUEUE_CREATE_INFO;</div>
<div class="line">    queue_create_infos[i].queueFamilyIndex = indices[i];</div>
<div class="line">    queue_create_infos[i].queueCount = 1;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a5f6906312a689f27d70e9d086649d3fd">f32</a> queue_priority = 1.0f;</div>
<div class="line">    queue_create_infos[i].pQueuePriorities = &amp;queue_priority;</div>
<div class="line">}</div>
<div class="ttc" id="adefines_8h_html_a5f6906312a689f27d70e9d086649d3fd"><div class="ttname"><a href="defines_8h.html#a5f6906312a689f27d70e9d086649d3fd">f32</a></div><div class="ttdeci">float f32</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00045">defines.h:45</a></div></div>
</div><!-- fragment --><p>Finally, create the logical device:</p>
<div class="fragment"><div class="line">VkDeviceCreateInfo device_create_info = {VK_STRUCTURE_TYPE_DEVICE_CREATE_INFO};</div>
<div class="line">device_create_info.queueCreateInfoCount = index_count;</div>
<div class="line">device_create_info.pQueueCreateInfos = queue_create_infos;</div>
<div class="line">device_create_info.pEnabledFeatures = &amp;device_features;</div>
<div class="line"> </div>
<div class="line">VK_CHECK(vkCreateDevice(<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.physical_device, &amp;device_create_info, <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;allocator, &amp;<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.logical_device));</div>
</div><!-- fragment --><p>‚úÖ This creates a way to submit commands to the GPU.</p>
<hr  />
<h3><a class="anchor" id="autotoc_md47"></a>
5. ‚è± Get Queues</h3>
<p>Once the device is created, get handles to the actual queues:</p>
<div class="fragment"><div class="line">vkGetDeviceQueue(<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.logical_device, <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.graphics_queue_index, 0, &amp;<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.graphics_queue);</div>
<div class="line">vkGetDeviceQueue(<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.logical_device, <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.present_queue_index, 0, &amp;<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.present_queue);</div>
</div><!-- fragment --><p>These are used later to:</p><ul>
<li>Submit draw commands (<code>graphics_queue</code>)</li>
<li>Present frames (<code>present_queue</code>)</li>
<li>Copy data (<code>transfer_queue</code>)</li>
</ul>
<hr  />
<h3><a class="anchor" id="autotoc_md49"></a>
6. üîÑ Query Swapchain Support</h3>
<p>Before creating a swapchain, check what formats and modes are supported:</p>
<div class="fragment"><div class="line"><span class="comment">// vulkan_device.c</span></div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="vulkan__device_8c.html#ac4eb42eebcc937d35197f1b899668021">vulkan_device_query_swapchain_support</a>(...) {</div>
<div class="line">    vkGetPhysicalDeviceSurfaceCapabilitiesKHR(device, surface, &amp;out_support-&gt;capabilities);</div>
<div class="line">    vkGetPhysicalDeviceSurfaceFormatsKHR(device, surface, &amp;out_support-&gt;format_count, 0);</div>
<div class="line">    vkGetPhysicalDeviceSurfacePresentModesKHR(device, surface, &amp;out_support-&gt;present_mode_count, 0);</div>
<div class="line">}</div>
<div class="ttc" id="avulkan__device_8c_html_ac4eb42eebcc937d35197f1b899668021"><div class="ttname"><a href="vulkan__device_8c.html#ac4eb42eebcc937d35197f1b899668021">vulkan_device_query_swapchain_support</a></div><div class="ttdeci">void vulkan_device_query_swapchain_support(VkPhysicalDevice physical_device, VkSurfaceKHR surface, vulkan_swapchain_support_info *out_support_info)</div><div class="ttdoc">Queries swapchain support details for a given physical device and surface.</div><div class="ttdef"><b>Definition</b> <a href="vulkan__device_8c_source.html#l00320">vulkan_device.c:320</a></div></div>
</div><!-- fragment --><p>This helps choose the best image format and presentation mode.</p>
<hr  />
<h3><a class="anchor" id="autotoc_md51"></a>
7. üîÅ Create Swapchain</h3>
<p>Now create the swapchain based on what the device supports:</p>
<div class="fragment"><div class="line"><span class="comment">// vulkan_swapchain.c</span></div>
<div class="line">VkSwapchainCreateInfoKHR create_info = {VK_STRUCTURE_TYPE_SWAPCHAIN_CREATE_INFO_KHR};</div>
<div class="line">create_info.surface = <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;surface;</div>
<div class="line">create_info.minImageCount = image_count;</div>
<div class="line">create_info.imageFormat = swapchain-&gt;image_format.format;</div>
<div class="line">create_info.imageExtent = swapchain_extent;</div>
<div class="line">create_info.imageUsage = VK_IMAGE_USAGE_COLOR_ATTACHMENT_BIT;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.graphics_queue_index != <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.present_queue_index) {</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> queueFamilyIndices[] = {</div>
<div class="line">        (<a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.graphics_queue_index,</div>
<div class="line">        (<a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.present_queue_index};</div>
<div class="line"> </div>
<div class="line">    create_info.imageSharingMode = VK_SHARING_MODE_CONCURRENT;</div>
<div class="line">    create_info.queueFamilyIndexCount = 2;</div>
<div class="line">    create_info.pQueueFamilyIndices = queueFamilyIndices;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    create_info.imageSharingMode = VK_SHARING_MODE_EXCLUSIVE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">VK_CHECK(vkCreateSwapchainKHR(<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.logical_device, &amp;create_info, <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;allocator, &amp;swapchain-&gt;handle));</div>
</div><!-- fragment --><p>üîÑ The swapchain acts like a rotating carousel of images:</p><ul>
<li>One is being drawn</li>
<li>One is being displayed</li>
<li>One is waiting to be used next</li>
</ul>
<p>This avoids tearing and ensures smooth rendering.</p>
<hr  />
<h3><a class="anchor" id="autotoc_md53"></a>
8. üñº Create Image Views</h3>
<p>Each image in the swapchain needs a <b>view</b> so the GPU can interpret it:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> i = 0; i &lt; swapchain-&gt;image_count; ++i) {</div>
<div class="line">    VkImageViewCreateInfo view_info = {VK_STRUCTURE_TYPE_IMAGE_VIEW_CREATE_INFO};</div>
<div class="line">    view_info.image = swapchain-&gt;images[i];</div>
<div class="line">    view_info.viewType = VK_IMAGE_VIEW_TYPE_2D;</div>
<div class="line">    view_info.format = swapchain-&gt;image_format.format;</div>
<div class="line">    view_info.subresourceRange.aspectMask = VK_IMAGE_ASPECT_COLOR_BIT;</div>
<div class="line">    view_info.subresourceRange.baseMipLevel = 0;</div>
<div class="line">    view_info.subresourceRange.levelCount = 1;</div>
<div class="line">    view_info.subresourceRange.baseArrayLayer = 0;</div>
<div class="line">    view_info.layerCount = 1;</div>
<div class="line"> </div>
<div class="line">    VK_CHECK(vkCreateImageView(<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.logical_device, &amp;view_info, <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;allocator, &amp;swapchain-&gt;views[i]));</div>
<div class="line">}</div>
</div><!-- fragment --><p>üñº Each image view wraps a raw <code>VkImage</code>, defining how it's accessed (e.g., color attachment, depth buffer).</p>
<hr  />
<h3><a class="anchor" id="autotoc_md55"></a>
9. üßä Detect Depth Format</h3>
<p>For depth testing, a compatible depth format is needed:</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="defines_8h.html#a7415f24c35cb3e16a79f143c5527fdfa">b8</a> <a class="code hl_function" href="vulkan__device_8c.html#a4af4291b3e9e0fc739c88bde97d74693">vulkan_device_detect_depth_format</a>(vulkan_device* device) {</div>
<div class="line">    <span class="keyword">const</span> <a class="code hl_typedef" href="defines_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> candidate_count = 3;</div>
<div class="line">    VkFormat candidates[candidate_count] = {</div>
<div class="line">        VK_FORMAT_D32_SFLOAT,</div>
<div class="line">        VK_FORMAT_D32_SFLOAT_S8_UINT,</div>
<div class="line">        VK_FORMAT_D24_UNORM_S8_UINT};</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code hl_typedef" href="defines_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a> i = 0; i &lt; candidate_count; ++i) {</div>
<div class="line">        VkFormatProperties props;</div>
<div class="line">        vkGetPhysicalDeviceFormatProperties(device-&gt;physical_device, candidates[i], &amp;props);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> ((props.optimalTilingFeatures &amp; VK_FORMAT_FEATURE_DEPTH_STENCIL_ATTACHMENT_BIT)) {</div>
<div class="line">            device-&gt;depth_format = candidates[i];</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code hl_define" href="defines_8h.html#add3ca9eefe3b5b754426f51d3043e579">True</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_define" href="logger_8h.html#a473bb2cc3b3bf3c93084eeca6cb19132">KERROR</a>(<span class="stringliteral">&quot;No supported depth format found.&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_define" href="defines_8h.html#a306ebd41c0cd1303b1372c6153f0caf8">False</a>;</div>
<div class="line">}</div>
<div class="ttc" id="adefines_8h_html_a306ebd41c0cd1303b1372c6153f0caf8"><div class="ttname"><a href="defines_8h.html#a306ebd41c0cd1303b1372c6153f0caf8">False</a></div><div class="ttdeci">#define False</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00106">defines.h:106</a></div></div>
<div class="ttc" id="adefines_8h_html_ad758b7a5c3f18ed79d2fcd23d9f16357"><div class="ttname"><a href="defines_8h.html#ad758b7a5c3f18ed79d2fcd23d9f16357">u64</a></div><div class="ttdeci">unsigned long long u64</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00026">defines.h:26</a></div></div>
<div class="ttc" id="adefines_8h_html_add3ca9eefe3b5b754426f51d3043e579"><div class="ttname"><a href="defines_8h.html#add3ca9eefe3b5b754426f51d3043e579">True</a></div><div class="ttdeci">#define True</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00104">defines.h:104</a></div></div>
<div class="ttc" id="alogger_8h_html_a473bb2cc3b3bf3c93084eeca6cb19132"><div class="ttname"><a href="logger_8h.html#a473bb2cc3b3bf3c93084eeca6cb19132">KERROR</a></div><div class="ttdeci">#define KERROR(message,...)</div><div class="ttdoc">Logs an error-level message.</div><div class="ttdef"><b>Definition</b> <a href="logger_8h_source.html#l00162">logger.h:162</a></div></div>
<div class="ttc" id="avulkan__device_8c_html_a4af4291b3e9e0fc739c88bde97d74693"><div class="ttname"><a href="vulkan__device_8c.html#a4af4291b3e9e0fc739c88bde97d74693">vulkan_device_detect_depth_format</a></div><div class="ttdeci">b8 vulkan_device_detect_depth_format(vulkan_device *device)</div><div class="ttdoc">Detects and selects a suitable depth/stencil format for the given device.</div><div class="ttdef"><b>Definition</b> <a href="vulkan__device_8c_source.html#l00366">vulkan_device.c:366</a></div></div>
</div><!-- fragment --><p>üßÉ Once selected, create a depth/stencil image and its view.</p>
<hr  />
<h3><a class="anchor" id="autotoc_md57"></a>
10. üé® Create Render Pass</h3>
<p>The render pass defines how rendering works ‚Äî what attachments to use, how they behave, and what subpasses exist.</p>
<div class="fragment"><div class="line"><span class="comment">// vulkan_renderpass.c</span></div>
<div class="line">VkAttachmentDescription attachments[2] = {};</div>
<div class="line">attachments[0].format = swapchain-&gt;image_format.format;</div>
<div class="line">attachments[0].loadOp = VK_ATTACHMENT_LOAD_OP_CLEAR;</div>
<div class="line">attachments[0].storeOp = VK_ATTACHMENT_STORE_OP_STORE;</div>
<div class="line">attachments[0].stencilLoadOp = VK_ATTACHMENT_LOAD_OP_DONT_CARE;</div>
<div class="line">attachments[0].initialLayout = VK_IMAGE_LAYOUT_UNDEFINED;</div>
<div class="line">attachments[0].finalLayout = VK_IMAGE_LAYOUT_PRESENT_SRC_KHR;</div>
<div class="line"> </div>
<div class="line">attachments[1].format = <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.depth_format;</div>
<div class="line">attachments[1].loadOp = VK_ATTACHMENT_LOAD_OP_CLEAR;</div>
<div class="line">attachments[1].storeOp = VK_ATTACHMENT_STORE_OP_DONT_CARE;</div>
<div class="line">attachments[1].initialLayout = VK_IMAGE_LAYOUT_UNDEFINED;</div>
<div class="line">attachments[1].finalLayout = VK_IMAGE_LAYOUT_DEPTH_STENCIL_ATTACHMENT_OPTIMAL;</div>
<div class="line"> </div>
<div class="line">VkSubpassDescription subpass = {};</div>
<div class="line">subpass.pipelineBindPoint = VK_PIPELINE_BIND_POINT_GRAPHICS;</div>
<div class="line">subpass.colorAttachmentCount = 1;</div>
<div class="line">subpass.pColorAttachments = &amp;color_ref;</div>
<div class="line">subpass.pDepthStencilAttachment = &amp;depth_stencil_ref;</div>
<div class="line"> </div>
<div class="line">VkRenderPassCreateInfo info = {};</div>
<div class="line">info.sType = VK_STRUCTURE_TYPE_RENDER_PASS_CREATE_INFO;</div>
<div class="line">info.attachmentCount = 2;</div>
<div class="line">info.pAttachments = attachments;</div>
<div class="line">info.subpassCount = 1;</div>
<div class="line">info.pSubpasses = &amp;subpass;</div>
<div class="line"> </div>
<div class="line">VK_CHECK(vkCreateRenderPass(<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.logical_device, &amp;info, <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;allocator, &amp;renderpass-&gt;handle));</div>
</div><!-- fragment --><p>üé® The render pass is like a <b>blueprint</b> ‚Äî it tells the GPU:</p><ul>
<li>What kind of data it will write to</li>
<li>How to handle clearing and storing it</li>
<li>What layout transitions happen between steps</li>
</ul>
<hr  />
<h3><a class="anchor" id="autotoc_md59"></a>
11. üñº Create Framebuffers</h3>
<p>Framebuffers combine images and render passes:</p>
<div class="fragment"><div class="line">VkFramebufferCreateInfo fb_info = {VK_STRUCTURE_TYPE_FRAMEBUFFER_CREATE_INFO};</div>
<div class="line">fb_info.renderPass = renderpass-&gt;handle;</div>
<div class="line">fb_info.attachmentCount = 2;</div>
<div class="line">fb_info.pAttachments = attachments;</div>
<div class="line">fb_info.width = width;</div>
<div class="line">fb_info.height = height;</div>
<div class="line">fb_info.layers = 1;</div>
<div class="line"> </div>
<div class="line">VK_CHECK(vkCreateFramebuffer(device, &amp;fb_info, 0, &amp;framebuffer));</div>
</div><!-- fragment --><p>üñº Each framebuffer links:</p><ul>
<li>A color image from the swapchain</li>
<li>A depth/stencil image</li>
<li>The render pass that defines how to use them</li>
</ul>
<hr  />
<h3><a class="anchor" id="autotoc_md61"></a>
12. üóÇ Command Buffers and Submission</h3>
<p>Command buffers store drawing commands:</p>
<div class="fragment"><div class="line"><span class="comment">// Begin command recording</span></div>
<div class="line">VkCommandBufferBeginInfo begin_info = {VK_STRUCTURE_TYPE_COMMAND_BUFFER_BEGIN_INFO};</div>
<div class="line">vkBeginCommandBuffer(command_buffer, &amp;begin_info);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Record draw commands here...</span></div>
<div class="line"> </div>
<div class="line">vkEndCommandBuffer(command_buffer);</div>
</div><!-- fragment --><p>Then submit to the GPU:</p>
<div class="fragment"><div class="line">VkSubmitInfo submit_info = {VK_STRUCTURE_TYPE_SUBMIT_INFO};</div>
<div class="line">submit_info.waitSemaphoreCount = 1;</div>
<div class="line">submit_info.pWaitSemaphores = &amp;image_available_semaphore;</div>
<div class="line">submit_info.commandBufferCount = 1;</div>
<div class="line">submit_info.pCommandBuffers = &amp;command_buffer;</div>
<div class="line"> </div>
<div class="line">VK_CHECK(vkQueueSubmit(graphics_queue, 1, &amp;submit_info, fence));</div>
</div><!-- fragment --><p>And finally present:</p>
<div class="fragment"><div class="line">VkPresentInfoKHR present_info = {VK_STRUCTURE_TYPE_PRESENT_INFO_KHR};</div>
<div class="line">present_info.swapchainCount = 1;</div>
<div class="line">present_info.pSwapchains = &amp;swapchain-&gt;handle;</div>
<div class="line">present_info.pImageIndices = &amp;image_index;</div>
<div class="line"> </div>
<div class="line">VkResult result = vkQueuePresentKHR(present_queue, &amp;present_info);</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md63"></a>
üß© Diagram: Full Rendering Flow</h2>
<div class="fragment"><div class="line">+-------------------+</div>
<div class="line">|   Application     |</div>
<div class="line">|   Entry Point     |</div>
<div class="line">| (application_run())|</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">|   Create Instance |</div>
<div class="line">| (vkCreateInstance)|</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">|   Create Surface  |</div>
<div class="line">| (vkCreateXcbSurfaceKHR) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Enumerate Physical|</div>
<div class="line">| Devices           |</div>
<div class="line">| (vkEnumeratePhysicalDevices) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Select Suitable   |</div>
<div class="line">| Physical Device   |</div>
<div class="line">| (select_physical_device) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Create Logical    |</div>
<div class="line">| Device            |</div>
<div class="line">| (vkCreateDevice)  |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Get Queue Handles |</div>
<div class="line">| (vkGetDeviceQueue) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Query Swapchain   |</div>
<div class="line">| Support           |</div>
<div class="line">| (vkGetPhysicalDeviceSurface*) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Create Swapchain  |</div>
<div class="line">| (vkCreateSwapchainKHR) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Create Image Views|</div>
<div class="line">| (vkCreateImageView) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Detect Depth      |</div>
<div class="line">| Format            |</div>
<div class="line">| (vulkan_device_detect_depth_format) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Create Depth Image|</div>
<div class="line">| (vulkan_image_create) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Create Render Pass|</div>
<div class="line">| (vkCreateRenderPass) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Create Framebuffer|</div>
<div class="line">| (vkCreateFramebuffer) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Begin Main Loop   |</div>
<div class="line">| (vkAcquireNextImageKHR) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Begin Render Pass |</div>
<div class="line">| (vkCmdBeginRenderPass) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Record Draw       |</div>
<div class="line">| Commands          |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| End Render Pass   |</div>
<div class="line">| (vkCmdEndRenderPass) |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Submit Command    |</div>
<div class="line">| Buffer to GPU     |</div>
<div class="line">| (vkQueueSubmit)   |</div>
<div class="line">+-------------------+</div>
<div class="line">           |</div>
<div class="line">           v</div>
<div class="line">+-------------------+</div>
<div class="line">| Present Frame     |</div>
<div class="line">| (vkQueuePresentKHR) |</div>
<div class="line">+-------------------+</div>
</div><!-- fragment --><p>This is the full <b>rendering loop</b> that happens every frame.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md65"></a>
üß∞ Key Structures Used</h2>
<h3><a class="anchor" id="autotoc_md66"></a>
&lt;tt&gt;vulkan_context&lt;/tt&gt;</h3>
<p>Tracks global Vulkan state: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>vulkan_context {</div>
<div class="line">    VkInstance instance;</div>
<div class="line">    VkSurfaceKHR surface;</div>
<div class="line">    VkDebugUtilsMessengerEXT debug_messenger;</div>
<div class="line">    vulkan_device device;</div>
<div class="line">    vulkan_swapchain swapchain;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> image_index;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> current_frame;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a7415f24c35cb3e16a79f143c5527fdfa">b8</a> recreating_swapchain;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a9e3ad5f8e752f01d926ce122d5a5285e">i32</a> (*<a class="code hl_function" href="vulkan__backend_8c.html#aada43db2d3a25f12c6511695c5d74d0a">find_memory_index</a>)(...);</div>
<div class="line">} vulkan_context;</div>
<div class="ttc" id="adefines_8h_html_a9e3ad5f8e752f01d926ce122d5a5285e"><div class="ttname"><a href="defines_8h.html#a9e3ad5f8e752f01d926ce122d5a5285e">i32</a></div><div class="ttdeci">signed int i32</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00037">defines.h:37</a></div></div>
<div class="ttc" id="avulkan__backend_8c_html_aada43db2d3a25f12c6511695c5d74d0a"><div class="ttname"><a href="vulkan__backend_8c.html#aada43db2d3a25f12c6511695c5d74d0a">find_memory_index</a></div><div class="ttdeci">i32 find_memory_index(u32 type_filter, u32 property_flags)</div><div class="ttdoc">Finds a suitable memory type index that satisfies the given constraints.</div><div class="ttdef"><b>Definition</b> <a href="vulkan__backend_8c_source.html#l00594">vulkan_backend.c:594</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md67"></a>
&lt;tt&gt;vulkan_device&lt;/tt&gt;</h3>
<p>Holds physical/logical device and queue info: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>vulkan_device {</div>
<div class="line">    VkPhysicalDevice physical_device;</div>
<div class="line">    VkDevice logical_device;</div>
<div class="line">    vulkan_swapchain_support_info swapchain_support;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a9e3ad5f8e752f01d926ce122d5a5285e">i32</a> graphics_queue_index;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a9e3ad5f8e752f01d926ce122d5a5285e">i32</a> present_queue_index;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a9e3ad5f8e752f01d926ce122d5a5285e">i32</a> transfer_queue_index;</div>
<div class="line">    VkQueue graphics_queue;</div>
<div class="line">    VkQueue present_queue;</div>
<div class="line">    VkQueue transfer_queue;</div>
<div class="line">    VkPhysicalDeviceProperties properties;</div>
<div class="line">    VkPhysicalDeviceFeatures features;</div>
<div class="line">    VkPhysicalDeviceMemoryProperties memory;</div>
<div class="line">    VkFormat depth_format;</div>
<div class="line">} vulkan_device;</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md68"></a>
&lt;tt&gt;vulkan_swapchain&lt;/tt&gt;</h3>
<p>Manages images and depth buffer: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>vulkan_swapchain {</div>
<div class="line">    VkSurfaceFormatKHR image_format;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#aed742c436da53c1080638ce6ef7d13de">u8</a> max_frames_in_flight;</div>
<div class="line">    VkSwapchainKHR handle;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> image_count;</div>
<div class="line">    VkImage* images;</div>
<div class="line">    VkImageView* views;</div>
<div class="line">    vulkan_image depth_attachment;</div>
<div class="line">} vulkan_swapchain;</div>
<div class="ttc" id="adefines_8h_html_aed742c436da53c1080638ce6ef7d13de"><div class="ttname"><a href="defines_8h.html#aed742c436da53c1080638ce6ef7d13de">u8</a></div><div class="ttdeci">unsigned char u8</div><div class="ttdef"><b>Definition</b> <a href="defines_8h_source.html#l00017">defines.h:17</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md69"></a>
&lt;tt&gt;vulkan_renderpass&lt;/tt&gt;</h3>
<p>Defines clear values and viewport settings: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>vulkan_renderpass {</div>
<div class="line">    VkRenderPass handle;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a5f6906312a689f27d70e9d086649d3fd">f32</a> clear_r, clear_g, clear_b, clear_a;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a5f6906312a689f27d70e9d086649d3fd">f32</a> clear_depth;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> clear_stencil;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a5f6906312a689f27d70e9d086649d3fd">f32</a> viewport_x, viewport_y, viewport_w, viewport_h;</div>
<div class="line">    <a class="code hl_typedef" href="defines_8h.html#a5f6906312a689f27d70e9d086649d3fd">f32</a> scissor_x, scissor_y, scissor_w, scissor_h;</div>
<div class="line">} vulkan_renderpass;</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md71"></a>
üí° Why All This Is Needed</h2>
<p>Vulkan is explicit by design. Every operation must be described precisely. Here's why each part matters:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Instance</b>   </td><td class="markdownTableBodyNone">Connects app to Vulkan driver    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Surface</b>   </td><td class="markdownTableBodyNone">Links window to GPU output    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Physical Device</b>   </td><td class="markdownTableBodyNone">Represents the actual GPU    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Logical Device</b>   </td><td class="markdownTableBodyNone">Interface to the GPU    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Queues</b>   </td><td class="markdownTableBodyNone">Workers for graphics/present/transfer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Swapchain</b>   </td><td class="markdownTableBodyNone">Manages sequence of renderable images    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Images</b>   </td><td class="markdownTableBodyNone">Raw GPU memory to draw into    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Image Views</b>   </td><td class="markdownTableBodyNone">Define how to read/write those images    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Render Pass</b>   </td><td class="markdownTableBodyNone">Defines rendering rules (clear/store ops, layout)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>Framebuffers</b>   </td><td class="markdownTableBodyNone">Combine images into something you can draw into    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>Command Buffers</b>   </td><td class="markdownTableBodyNone">Store GPU commands to execute later   </td></tr>
</table>
<hr  />
<h2><a class="anchor" id="autotoc_md73"></a>
üß± Summary Table</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Module   </th><th class="markdownTableHeadNone">Responsibility    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="vulkan__backend_8c.html#a0b90ec94f78aae6814140d684323d8d2" title="Initializes the Vulkan renderer backend.">vulkan_renderer_backend_initialize()</a></code>   </td><td class="markdownTableBodyNone">Creates instance, surface, and starts device setup    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="vulkan__device_8c.html#abb07eb6d710c4e98364b57e42e4af4ac" title="Creates and selects a suitable physical/logical Vulkan device.">vulkan_device_create()</a></code>   </td><td class="markdownTableBodyNone">Selects physical device, creates logical device    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="vulkan__device_8c.html#ac4eb42eebcc937d35197f1b899668021" title="Queries swapchain support details for a given physical device and surface.">vulkan_device_query_swapchain_support()</a></code>   </td><td class="markdownTableBodyNone">Queries device capabilities for swapchain    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="vulkan__swapchain_8c.html#a3385e045032018c37ee427c2caa82bfb" title="Creates and initializes a Vulkan swapchain for rendering.">vulkan_swapchain_create()</a></code>   </td><td class="markdownTableBodyNone">Initializes the swapchain and image views    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="vulkan__device_8c.html#a4af4291b3e9e0fc739c88bde97d74693" title="Detects and selects a suitable depth/stencil format for the given device.">vulkan_device_detect_depth_format()</a></code>   </td><td class="markdownTableBodyNone">Finds a usable depth format    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="vulkan__renderpass_8c.html#a6cb37ba96525608948661a9a41a15506" title="Creates a new render pass using the provided configuration.">vulkan_renderpass_create()</a></code>   </td><td class="markdownTableBodyNone">Sets up how we render    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code><a class="el" href="vulkan__command__buffer_8c.html#a953bb97410e7ac3fb6bcb885111b076a" title="Begins recording commands into the command buffer.">vulkan_command_buffer_begin()</a></code>   </td><td class="markdownTableBodyNone">Starts recording draw commands    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code><a class="el" href="vulkan__swapchain_8c.html#a401617aff019b05a923dcda96f83c958" title="Presents the rendered image at the given index to the screen.">vulkan_swapchain_present()</a></code>   </td><td class="markdownTableBodyNone">Presents the final image to the screen   </td></tr>
</table>
<hr  />
<h2><a class="anchor" id="autotoc_md75"></a>
üß™ Bonus: Sample Code for Acquiring an Image</h2>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="defines_8h.html#a7415f24c35cb3e16a79f143c5527fdfa">b8</a> <a class="code hl_function" href="vulkan__swapchain_8c.html#a559f69815dfb6ccb3a6776516d9025b7">vulkan_swapchain_acquire_next_image_index</a>(...) {</div>
<div class="line">    VkResult result = vkAcquireNextImageKHR(</div>
<div class="line">        <a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>-&gt;device.logical_device,</div>
<div class="line">        swapchain-&gt;handle,</div>
<div class="line">        timeout_ns,</div>
<div class="line">        image_available_semaphore,</div>
<div class="line">        fence,</div>
<div class="line">        out_image_index);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (result == VK_ERROR_OUT_OF_DATE_KHR) {</div>
<div class="line">        <a class="code hl_function" href="vulkan__swapchain_8c.html#a37945527d25893e83ecde0d83f11b550">vulkan_swapchain_recreate</a>(<a class="code hl_variable" href="vulkan__backend_8c.html#a171b208055a0eb2eeace24e130f74bc9">context</a>, width, height, swapchain);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_define" href="defines_8h.html#a306ebd41c0cd1303b1372c6153f0caf8">False</a>;</div>
<div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (result != VK_SUCCESS &amp;&amp; result != VK_SUBOPTIMAL_KHR) {</div>
<div class="line">        <a class="code hl_define" href="logger_8h.html#a8eb60bd7b3dfc5cadc7364b06ce7bd07">KFATAL</a>(<span class="stringliteral">&quot;Failed to acquire swapchain image!&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_define" href="defines_8h.html#a306ebd41c0cd1303b1372c6153f0caf8">False</a>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_define" href="defines_8h.html#add3ca9eefe3b5b754426f51d3043e579">True</a>;</div>
<div class="line">}</div>
<div class="ttc" id="alogger_8h_html_a8eb60bd7b3dfc5cadc7364b06ce7bd07"><div class="ttname"><a href="logger_8h.html#a8eb60bd7b3dfc5cadc7364b06ce7bd07">KFATAL</a></div><div class="ttdeci">#define KFATAL(message,...)</div><div class="ttdoc">Logs a fatal-level message.</div><div class="ttdef"><b>Definition</b> <a href="logger_8h_source.html#l00149">logger.h:149</a></div></div>
<div class="ttc" id="avulkan__swapchain_8c_html_a37945527d25893e83ecde0d83f11b550"><div class="ttname"><a href="vulkan__swapchain_8c.html#a37945527d25893e83ecde0d83f11b550">vulkan_swapchain_recreate</a></div><div class="ttdeci">void vulkan_swapchain_recreate(vulkan_context *context, u32 width, u32 height, vulkan_swapchain *swapchain)</div><div class="ttdoc">Recreates the swapchain after resize or resolution change.</div><div class="ttdef"><b>Definition</b> <a href="vulkan__swapchain_8c_source.html#l00080">vulkan_swapchain.c:80</a></div></div>
<div class="ttc" id="avulkan__swapchain_8c_html_a559f69815dfb6ccb3a6776516d9025b7"><div class="ttname"><a href="vulkan__swapchain_8c.html#a559f69815dfb6ccb3a6776516d9025b7">vulkan_swapchain_acquire_next_image_index</a></div><div class="ttdeci">b8 vulkan_swapchain_acquire_next_image_index(vulkan_context *context, vulkan_swapchain *swapchain, u64 timeout_ns, VkSemaphore image_available_semaphore, VkFence fence, u32 *out_image_index)</div><div class="ttdoc">Acquires the index of the next available image from the swapchain.</div><div class="ttdef"><b>Definition</b> <a href="vulkan__swapchain_8c_source.html#l00118">vulkan_swapchain.c:118</a></div></div>
</div><!-- fragment --><p>This function gets the next image from the swapchain ‚Äî and triggers recreation if needed.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md77"></a>
üö´ Common Errors and Fixes</h2>
<h3><a class="anchor" id="autotoc_md78"></a>
‚ùå &lt;tt&gt;VK_DEBUG_UTILS_MESSAGE_SEVERITY_WARNING_EXT&lt;/tt&gt;: No cache file</h3>
<p>Not critical ‚Äî just means the shader cache doesn't exist yet.</p>
<hr  />
 </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jun 26 2025 17:53:37 for Koru Game Engine by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
